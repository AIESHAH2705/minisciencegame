<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Animal Sound Match â€” Upgraded</title>
<style>
  :root{
    --bg:#fce4ec; --accent:#c2185b; --card:#f8bbd0; --good:#4a148c; --bad:#d32f2f;
  }
  body{
    font-family: "Comic Sans MS", cursive, sans-serif;
    background:var(--bg);
    margin:0; padding:20px; color:var(--accent);
    display:flex; flex-direction:column; align-items:center;
  }
  h1{ margin:4px 0 0; font-size:1.8rem; }
  p.lead{ margin:6px 0 14px; color:#7b1fa2 }

  /* top controls */
  .topbar{
    width:100%; max-width:980px;
    display:flex; gap:12px; align-items:center;
    justify-content:space-between; flex-wrap:wrap;
  }
  .left-controls{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  #score{ font-weight:700; color:#ad1457; }
  #timer{ font-weight:700; color:#6a1b9a; }

  /* layout */
  .board{ width:100%; max-width:980px; display:flex; gap:28px; justify-content:center; align-items:flex-start; margin-top:16px; flex-wrap:wrap; }
  #animals{ display:flex; flex-wrap:wrap; gap:12px; justify-content:center; width:320px; }
  .animal{
    width:110px; cursor:grab; user-select:none; touch-action:none;
    border-radius:12px; overflow:hidden; background:white; box-shadow:0 6px 14px rgba(0,0,0,0.08);
    display:flex; align-items:center; justify-content:center; padding:6px; transition:transform .18s ease, opacity .4s;
  }
  .animal.dragging{ transform:scale(1.08); opacity:0.85; }
  .animal img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:8px; }

  #sounds{ display:flex; flex-direction:column; gap:12px; width:320px; align-items:center; }
  .sound{
    width:100%; max-width:320px; height:66px; border-radius:14px; background:var(--card);
    display:flex; align-items:center; justify-content:center; font-weight:800; color:#880e4f; font-size:18px;
    user-select:none; transition:transform .22s ease, background .22s;
  }
  .sound.correct{ background:#f48fb1; color:var(--good); transform:translateY(-6px) scale(1.03); }

  #message{ margin-top:18px; font-size:1.05rem; min-height:28px; font-weight:700; color:var(--accent); }

  #controls{ margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  button{ background:var(--accent); color:white; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; }
  button.secondary{ background:#7b1fa2; }
  button:active{ transform:translateY(1px); }

  /* responsive mobile */
  @media (max-width:720px){
    .board{ flex-direction:column; align-items:center; gap:18px; }
    #animals, #sounds{ width:94%; max-width:420px; }
    .animal{ width:140px; height:100px; }
    .sound{ height:76px; font-size:20px; border-radius:12px; }
  }

  /* tiny helpers */
  .muted{ opacity:0.85; font-size:0.95rem; color:#5e2a68; }
</style>
</head>
<body>

<h1>Animal Sound Match</h1>
<p class="lead">Drag or tap & drag the animal to its sound. Try to match all before time runs out!</p>

<div class="topbar">
  <button id="backBtn" class="secondary" style="margin-right:10px;">â¬… Back</button>
  <div class="left-controls">
    <div id="score">Score: 0 / 6</div>
    <div id="timer">Time: 45s</div>
    <div class="muted" id="best">Best: â€”</div>
  </div>
  <div>
    <button id="speakBtn" class="secondary">ðŸ”Š Voice On</button>
    <button id="resetBtn">ðŸ”„ Reset</button>
  </div>
</div>

<div class="board" role="application" aria-label="Animal sound matching">
  <div id="animals" aria-hidden="false">
    <div class="animal" draggable="true" id="cat" data-name="Cat"><img src="cat.jpg" alt="Cat"/></div>
    <div class="animal" draggable="true" id="dog" data-name="Dog"><img src="dog.jpg" alt="Dog"/></div>
    <div class="animal" draggable="true" id="cow" data-name="Cow"><img src="cow.jpg" alt="Cow"/></div>
    <div class="animal" draggable="true" id="sheep" data-name="Sheep"><img src="sheep.jpg" alt="Sheep"/></div>
    <div class="animal" draggable="true" id="chicken" data-name="Chicken"><img src="chicken.jpg" alt="Chicken"/></div>
    <div class="animal" draggable="true" id="horse" data-name="Horse"><img src="horse.jpg" alt="Horse"/></div>
  </div>

  <div id="sounds" aria-hidden="false">
    <div class="sound" id="meow">Meow</div>
    <div class="sound" id="bark">Bark</div>
    <div class="sound" id="moo">Moo</div>
    <div class="sound" id="baa">Baa</div>
    <div class="sound" id="cluck">Cluck</div>
    <div class="sound" id="neigh">Neigh</div>
  </div>
</div>

<div id="message" aria-live="polite"></div>

<!-- audio elements -->
<audio id="sound-meow" src="meow.mp3" preload="auto"></audio>
<audio id="sound-bark" src="bark.mp3" preload="auto"></audio>
<audio id="sound-moo" src="moo.mp3" preload="auto"></audio>
<audio id="sound-baa" src="baa.mp3" preload="auto"></audio>
<audio id="sound-cluck" src="cluck.mp3" preload="auto"></audio>
<audio id="sound-neigh" src="neigh.mp3" preload="auto"></audio>

<!-- confetti CDN -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
/* -------------------------
   Game configuration
   ------------------------- */
const matchPairs = { meow: 'cat', bark: 'dog', moo: 'cow', baa: 'sheep', cluck: 'chicken', neigh: 'horse' };
const totalMatches = Object.keys(matchPairs).length;
const START_SECONDS = 45;

/* -------------------------
   State & elements
   ------------------------- */
const animals = document.querySelectorAll('.animal');
const sounds = document.querySelectorAll('.sound');
const scoreEl = document.getElementById('score');
const timerEl = document.getElementById('timer');
const messageEl = document.getElementById('message');
const resetBtn = document.getElementById('resetBtn');
const speakBtn = document.getElementById('speakBtn');
const bestEl = document.getElementById('best');
const backBtn = document.getElementById('backBtn');

let score = 0;
let matched = new Set();
let timer = START_SECONDS;
let timerInterval = null;
let timerRunning = false;
let voiceEnabled = true;

/* Load best score from localStorage */
const BEST_KEY = 'animalmatch_best';
const best = localStorage.getItem(BEST_KEY);
if(best) bestEl.textContent = `Best: ${best} / ${totalMatches}`;

/* Utility: speak text if voiceEnabled */
function speak(text){
  if(!voiceEnabled) return;
  if(!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US';
  u.rate = 1;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* Timer logic */
function startTimerOnce(){
  if(timerRunning) return;
  timerRunning = true;
  speak("Go! Match the animals!");
  timerInterval = setInterval(()=>{
    timer--;
    timerEl.textContent = `Time: ${timer}s`;
    if(timer <= 0){
      clearInterval(timerInterval);
      endGame(false, "Time's up! Try again.");
    }
  },1000);
}

/* End game - win true/false */
function endGame(win, text){
  timerRunning = false;
  clearInterval(timerInterval);
  messageEl.textContent = text;
  messageEl.style.color = win ? '#2e7d32' : '#d32f2f';
  if(win){
    speak("Excellent! You matched all animals!");
    confetti({ particleCount: 220, spread: 110, origin: { y: 0.6 } });
    const prev = parseInt(localStorage.getItem(BEST_KEY) || '0', 10);
    if(score > prev){ localStorage.setItem(BEST_KEY, score); bestEl.textContent = `Best: ${score} / ${totalMatches}`; }
  } else {
    speak(text);
  }
  sounds.forEach(s => s.classList.add('disabled'));
}

/* Reset game without reload */
function resetGame(){
  score = 0; matched.clear(); timer = START_SECONDS; timerRunning = false;
  scoreEl.textContent = `Score: ${score} / ${totalMatches}`;
  timerEl.textContent = `Time: ${timer}s`;
  messageEl.textContent = '';
  animals.forEach(a=>{
    a.style.opacity = '1';
    a.style.display = '';
    a.classList.remove('dragging');
    a.setAttribute('draggable','true');
  });
  sounds.forEach(s=>{
    s.classList.remove('correct','disabled');
    s.textContent = s.id === 'meow' ? 'Meow' :
                    s.id === 'bark' ? 'Bark' :
                    s.id === 'moo' ? 'Moo' :
                    s.id === 'baa' ? 'Baa' :
                    s.id === 'cluck' ? 'Cluck' : 'Neigh';
  });
  document.querySelectorAll('audio').forEach(a=>{ a.pause(); a.currentTime = 0; });
  if('speechSynthesis' in window) speechSynthesis.cancel();
}

/* Play audio helper */
function playAudioFor(soundId){
  const audio = document.getElementById(`sound-${soundId}`);
  if(!audio) return;
  audio.currentTime = 0;
  audio.play().catch(()=>{/* ignore autoplay block */});
}

/* Update score and check win */
function registerCorrect(soundId, animalId){
  if(matched.has(soundId)) return;
  matched.add(soundId);
  score++;
  scoreEl.textContent = `Score: ${score} / ${totalMatches}`;
  playAudioFor(soundId);
  speak("Good job!");
  if(score === totalMatches) endGame(true, "Excellent! You matched all animals!");
}

/* -------------------------
   Drag & Drop: mouse support
   ------------------------- */
animals.forEach(animal=>{
  animal.addEventListener('dragstart', e=>{
    startTimerOnce();
    const id = e.target.closest('.animal').id;
    e.dataTransfer.setData('text/plain', id);
    setTimeout(()=> animal.classList.add('dragging'), 10);
  });
  animal.addEventListener('dragend', e=>{
    animal.classList.remove('dragging');
  });
});

sounds.forEach(sound=>{
  sound.addEventListener('dragover', e=> e.preventDefault());
  sound.addEventListener('drop', e=>{
    e.preventDefault();
    const draggedId = e.dataTransfer.getData('text/plain');
    handleDrop(sound.id, draggedId);
  });
});

/* -------------------------
   Touch support (mobile)
   ------------------------- */
let touchClone = null;
let currentTouchId = null;

function onTouchStart(e){
  startTimerOnce();
  const t = e.changedTouches[0];
  const el = e.currentTarget;
  currentTouchId = t.identifier;

  touchClone = el.cloneNode(true);
  touchClone.style.position = 'fixed';
  touchClone.style.left = (t.clientX - el.offsetWidth/2) + 'px';
  touchClone.style.top = (t.clientY - el.offsetHeight/2) + 'px';
  touchClone.style.pointerEvents = 'none';
  touchClone.style.opacity = '0.95';
  touchClone.style.width = el.offsetWidth + 'px';
  touchClone.style.zIndex = 9999;
  touchClone.classList.add('dragging');
  document.body.appendChild(touchClone);
  el.style.opacity = '0.5';
}

function onTouchMove(e){
  if(!touchClone) return;
  for(const t of e.changedTouches){
    if(t.identifier === currentTouchId){
      touchClone.style.left = (t.clientX - touchClone.offsetWidth/2) + 'px';
      touchClone.style.top = (t.clientY - touchClone.offsetHeight/2) + 'px';
      e.preventDefault();
      break;
    }
  }
}

function onTouchEnd(e){
  if(!touchClone) return;
  const t = e.changedTouches[0];
  const dropEl = document.elementFromPoint(t.clientX, t.clientY);
  const originalId = touchClone.id;
  const origAnimal = document.getElementById(originalId);
  if(origAnimal) origAnimal.style.opacity = '1';
  touchClone.remove();
  touchClone = null;

  let droppedOnSound = dropEl;
  while(droppedOnSound && !droppedOnSound.classList.contains('sound')) droppedOnSound = droppedOnSound.parentElement;
  if(droppedOnSound){
    handleDrop(droppedOnSound.id, originalId);
  } else {
    messageEl.textContent = '';
  }
}

animals.forEach(a=>{
  a.addEventListener('touchstart', onTouchStart, {passive:false});
  a.addEventListener('touchmove', onTouchMove, {passive:false});
  a.addEventListener('touchend', onTouchEnd);
  a.addEventListener('touchcancel', onTouchEnd);
});

/* -------------------------
   Drop handler shared
   ------------------------- */
function handleDrop(soundId, animalId){
  if(timer <= 0) return;
  if(matched.has(soundId)) {
    messageEl.textContent = 'Already matched!';
    speak('Already matched!');
    return;
  }
  if(matchPairs[soundId] === animalId){
    const s = document.getElementById(soundId);
    s.classList.add('correct');
    s.textContent = 'Correct!';
    const a = document.getElementById(animalId);
    if(a){
      a.style.transition = 'opacity .6s, transform .5s';
      a.style.transform = 'scale(.92)';
      a.style.opacity = '0';
      a.setAttribute('draggable','false');
    }
    registerCorrect(soundId, animalId);
  } else {
    messageEl.textContent = 'Oops! Try again.';
    messageEl.style.color = '#d32f2f';
    speak('Try again');
    const s = document.getElementById(soundId);
    s.animate([{transform:'translateX(-6px)'},{transform:'translateX(6px)'},{transform:'translateX(0)'}], {duration:250});
  }
}

/* -------------------------
   Button handlers
   ------------------------- */
resetBtn.addEventListener('click', ()=>{
  confetti && confetti.reset && confetti.reset();
  resetGame();
});

speakBtn.addEventListener('click', ()=>{
  voiceEnabled = !voiceEnabled;
  speakBtn.textContent = voiceEnabled ? 'ðŸ”Š Voice On' : 'ðŸ”ˆ Voice Off';
  if(voiceEnabled) speak('Voice instructions enabled');
});

backBtn.addEventListener('click', ()=>{
  window.history.back();
});

/* Start instructions */
speak("Welcome! Drag each animal to its sound. Press reset to restart.");

/* Prevent contextmenu on long press mobile */
document.addEventListener('contextmenu', e=> e.preventDefault());

scoreEl.textContent = `Score: ${score} / ${totalMatches}`;
timerEl.textContent = `Time: ${timer}s`;

</script>
</body>
</html>
